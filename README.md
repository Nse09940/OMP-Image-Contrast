# OpenMP-Ускоренный Оптимизатор Контрастности Изображений

Высокопроизводительный инструмент на C++ для автоматического улучшения контрастности изображений (Auto-Contrast) с использованием OpenMP для многопоточного ускорения. Этот проект демонстрирует оптимизированные параллельные алгоритмы обработки изображений, уделяя особое внимание вычислению гистограмм, дружелюбному к кэшу, и преобразованиям с использованием таблиц поиска (LUT).

## Особенности

- Многопоточная обработка: Использует OpenMP для параллелизации вычислительно сложных задач.
- Оптимизированное вычисление гистограммы: Использует локальную память потоков для предотвращения конфликтов кэша и накладных расходов на синхронизацию.
- Быстрое преобразование: Реализует подход с таблицей поиска (LUT) для достижения сложности преобразования пикселей O(1).
- Настраиваемое планирование: Поддерживает стратегии планирования OpenMP static (статическое) и dynamic (динамическое).
- Поддержка форматов: Работает с форматами изображений Netpbm (PNM) (P5 для оттенков серого, P6 для RGB).

## Обзор алгоритма

Алгоритм автоконтраста состоит из следующих этапов:
1. Параллельное вычисление гистограммы: Сканирование изображения для подсчета интенсивности пикселей. Каждый поток ведет свою собственную гистограмму для обеспечения максимальной производительности.
2. Определение динамического диапазона: Идентификация границ минимальной и максимальной яркости после исключения небольшого процента выбросов (определяется параметром --coeff).
3. Генерация LUT: Вычисление таблицы преобразования из 256 элементов для сопоставления исходного диапазона с [0, 255].
4. Параллельное отображение: Параллельное применение LUT ко всем пикселям изображения.

## Бенчмарки производительности

Тестирование проводилось на процессоре Intel Core i7-1255U (12 потоков).

### Масштабируемость (изображение 70 МБ)

| Потоки | Время (мс) | Ускорение |
|:-------:|:---------:|:-------:|
| 1       | 74.0      | 1.0x    |
| 2       | 38.5      | 1.9x    |
| 4       | 25.0      | 3.0x    |
| 8       | 20.2      | 3.7x    |
| 12      | 18.5      | 4.0x    |

### Сравнение стратегий планирования

В проекте анализируются различные стратегии планирования OpenMP. Результаты тестов на изображении 70 МБ с использованием 8 потоков:

| Тип планирования | Размер чанка (Chunk) | Время (мс) |
|:---------------:|:----------:|:---------:|
| Static          | По умолчанию (0)   | 25        |
| Dynamic         | 1                   | 3724      |
| Dynamic         | 10,000              | 34        |
| Dynamic         | 100,000             | 28        |

Примечание: Статическое планирование с чанками по умолчанию показывает наилучшие результаты из-за равномерной вычислительной нагрузки на каждый пиксель.

## Использование

### Компиляция

Скомпилируйте с помощью g++ с поддержкой OpenMP и флагами оптимизации:

```bash
g++ -O3 -std=c++17 -fopenmp main.cpp -o image_optimizer
```

### Запуск

```bash
./image_optimizer --input <путь_к_pnm> --output <путь_вывода> [опции]
```

**Опции:**
- --threads <n>: Количество используемых потоков (по умолчанию: 1).
- --coeff <f>: Доля пикселей, игнорируемых при расчете контрастности (например, 0.005 для 0.5%).
- --schedule <kind>: Тип планирования OpenMP (static или dynamic).
- --chunk <z>: Размер чанка для планировщика.
